<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aroma Of Biriyani</title>
  </head>
  <body bgcolor="olive">
    <table class="table">
          <form onsubmit="saveData(event);">
            <h1><b>Biriyani House</b></h1>
            <h2>Food Order Tracker</h2>
          <br/>
            <div class="form-group">
                <label>Choose Table</label>
                <select
                  name="ChooseTableDetails"
                  id="ChooseTableDetails"
                  class="form-control"
                >
                  <option value="Table1">Table1</option>
                  <option value="Table2">Table2</option>
                  <option value="Table3">Table3</option>  
                </select>
              </div>

            <div class="form-group">
              <label>Dish Name:</label>
              <input
                type="text"
                name="DishDetails"
                id="DishDetails"
                maxlength="30"
                class="form-control"
              />
            </div>
           
            <div class="form-group">
                <label>Price</label>
                <input
                  type="text"
                  name="PriceDetails"
                  id="PriceDetails"
                  class="form-control"
                />
              </div>


            <div class="form-action-buttons">
              <input type="submit" value="Add to bill" class="btn btn-info" />
            </div>
          </form>

        </br>
          <h2><b>Orders</b></h2>
          <p id="displayError" class="validation-error"></p>
          <ul id="users" class="list-group"></ul>
    </table>
    <script>
      let PriceDetails = document.getElementById("PriceDetails");
      let DishDetails = document.getElementById("DishDetails");
      let ChooseTableDetails = document.getElementById("ChooseTableDetails");
      let usersList = document.getElementById("users");

      async function saveData(e) {
        try {
          e.preventDefault();
          const Price = e.target.PriceDetails.value;
          const Dish = e.target.DishDetails.value;
          const ChooseTable = e.target.ChooseTableDetails.value;
          if (Price == "" || Dish == "" || ChooseTable == "")
            throw "Input field must not be empty";
          if (isNaN(Price)) throw "Price field must be a number";
          const obj = {
            Price,
            Dish,
            ChooseTable,
          };
          const response = await axios.post(
            "https://crudcrud.com/api/3367c3c7321e424fb5158fa814c598a0/Price",
            obj
          );
          if (response.status === 201) {
            displayListOnScreen(response.data);
            resetForm();
          } else {
            throw new Error("Failed To create new Price");
          }
        } catch (error) {
          showError(error);
        }
      }

      window.addEventListener("load", getList);

      function displayListOnScreen(user) {
        const parentNode = usersList;
        const PriceElemId = `Price-${user._id}`;
        const childHTML = `<li id=${PriceElemId} class="list-group-item"> <span class="font-style">${user.Price}</span> - <span class="crimson-text">${user.Dish}</span>
                              <button type="button" id="btn1" class="btn btn-danger btn-xs" onclick=deleteList('${user._id}')> Delete </button>
                              <button type="button" id="btn2" class="btn btn-primary btn-xs" onclick=editList('${user._id}','${user.Dish}','${user.Price}','${user.ChooseTable}')>Edit</button>
                           </li>`;

        parentNode.innerHTML = parentNode.innerHTML + childHTML;
      }

      //Edit

      async function editList(Priceid, Dish, Price, ChooseTable) {
        try {
          PriceDetails.value = Price;
          DishDetails.value = Dish;
          ChooseTableDetails.value = ChooseTable;

          const response = await axios.delete(
            `https://crudcrud.com/api/3367c3c7321e424fb5158fa814c598a0/Price/${Priceid}`
          );
          if (response.status === 200) {
            removeListFromScreen(Priceid);
          } else {
            throw new Error("Failed to delete");
          }
        } catch (error) {
          showError(error);
        }
      }

      // Delete
      async function deleteList(Priceid) {
        try {
          if (confirm("Are you sure to delete this record ?")) {
            const response = await axios.delete(
              `https://crudcrud.com/api/3367c3c7321e424fb5158fa814c598a0/Price/${Priceid}`
            );
            if (response.status === 200) {
              removeListFromScreen(Priceid);
            } else {
              throw new Error("Failed to delete");
            }
          } else {
            throw new Error("Error");
          }
        } catch (error) {
          showError(error);
        }
      }

      function showError(err) {
        document.getElementById("displayError").innerHTML = err;
      }

      function removeListFromScreen(Priceid) {
        const PriceElemId = `Price-${Priceid}`;
        document.getElementById(PriceElemId).remove();
      }

      function resetForm() {
        PriceDetails.value = "";
        DishDetails.value = "";
        ChooseTableDetails.value = "";
        PriceDetails.focus();
      }

      async function getList() {
        try {
          const response = await axios.get(
            "https://crudcrud.com/api/3367c3c7321e424fb5158fa814c598a0/Price"
          );
          if (response.status === 200) {
            usersList.innerHTML = "";
            resetForm();
            response.data.forEach((Price) => {
              displayListOnScreen(Price);
            });
          } else {
            throw new Error("Oops! something went wrong");
          }
        } catch (error) {
          showError(error);
        }
      }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"></script>
  </body>
</html>